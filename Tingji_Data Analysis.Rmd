---
title: "Data Analysis - MSSP Group C2 Fall 2025"
author: "Tingji"
date: "2025-09-23"
output: html_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
set.seed(42)
``` 



## Purpose and Dataset

We will look:

- How one should approach a dataset
- What are the steps followed in analyzing a dataset

Goal. Explore the AirQuality dataset (hourly averages, March 2004–Feb 2005) to:

- understand structure & quality,
- handle missing values,
- do basic EDA (trends, correlations, drift),
- build a simple model for a target variable (e.g., CO).


#### Why these steps?

Good analysis = (1) clean data → (2) understand patterns → (3) model carefully. Each step documents decisions so results are reproducible and defensible.

### Libraries and Project Setup

Use this space to install and store all the packages.

```{r packages, echo=TRUE, message=FALSE}
# Install once if needed and comment it out
# install.packages(c("tidyverse","dplyr", GGally", "ggplot2"))
library(corrplot)
library(tidyverse)
library(dplyr)
library(GGally) 
library(ggplot2)
```

### Import Data

Read the DataDescription.txt and note important information. Read it thoroughly!


```{r}
air_raw <- read.csv("AirQualityData.csv",sep = ";",header = TRUE)
summary(air_raw) 

names(air_raw)
head(air_raw)
air <- air_raw
```

#Change the missing data from -200 to NA to median value
```{r}
#check how many values in Ground CO is missing
length(which(air_raw$CO.GT. == -200))

air[air == -200] <- NA

ggplot(air,aes(x = Date,y = PT08.S1.CO.)) +
  geom_point()

air <- air %>% 
  rename(GroundCO = CO.GT.,SensorCO = PT08.S1.CO.)

ggplot(air,aes(x = GroundCO)) +
  geom_histogram(bins = 30) +
  labs(title = "GroundCO remove -200 value")
#the distribution is screwed, so use median to replace NA


#missing value change to median repalce
#median(air$GroundCO, na.rm = TRUE)
for (i in 3:15){
  m = median(air[,i], na.rm = TRUE)
  air[,i][is.na(air[,i])] = m
}
#from dplyr
# air <- air %>%
#   mutate(across(3:15, ~ ifelse(is.na(.), median(., na.rm = TRUE), .)))
ggplot(air,aes(x = GroundCO)) +
  geom_histogram(bins = 30) +
  labs(title = "GroundCO after change NA to Median value")
```

#boxplot for every element
```{r}
#box plot for numerical variables and see outliers
air_long <- pivot_longer(air[, 3:15], cols = everything(),
                         names_to = "Variable", values_to = "Value")

ggplot(air_long, aes(x = Variable, y = Value)) +
  geom_boxplot(outlier.colour = "red") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


#correlation heatmap
```{r}
# 先算相关矩阵
corr_matrix <- cor(air[, 3:15], use = "complete.obs")

# 画图
corrplot(corr_matrix,
         method = "color",     # 用颜色表示
         tl.col = "black",     # 标签颜色
         tl.srt = 45)          # 标签旋转角度
```










