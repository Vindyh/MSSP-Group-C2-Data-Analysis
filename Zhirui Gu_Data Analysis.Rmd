---
title: "Data Analysis - MSSP Group C2 Fall 2025"
author: "Zhirui Gu"
date: "2025-09-23"
output: html_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
set.seed(42)
```

## Purpose and Dataset

We will look:

-   How one should approach a dataset
-   What are the steps followed in analyzing a dataset

Goal. Explore the AirQuality dataset (hourly averages, March 2004–Feb 2005) to:

-   understand structure & quality,
-   handle missing values,
-   do basic EDA (trends, correlations, drift),
-   build a simple model for a target variable (e.g., CO).

#### Why these steps?

Good analysis = (1) clean data → (2) understand patterns → (3) model carefully. Each step documents decisions so results are reproducible and defensible.

### Libraries and Project Setup

Use this space to install and store all the packages.

```{r packages, echo=TRUE, message=FALSE}
# Install once if needed and comment it out
# install.packages(c("tidyverse","dplyr", GGally", "ggplot2"))
library(tidyverse)
library(dplyr)
library(GGally) 
library(ggplot2)
```

### Import Data

Read the DataDescription.txt and note important information. Read it thoroughly!

```{r}
data_raw <- read.csv("AirQualityData.csv",sep = ";", header = TRUE)
aq_data <- data_raw
names(aq_data)
str(aq_data)
```

```{r}
data_raw <- read.csv("AirQualityData.csv",sep = ";", header = TRUE)
aq_data <- data_raw

summary(data_raw)
aq_data[aq_data == -200] <- NA

aq_data <- aq_data %>% 
  rename(GroundCO = CO.GT.,SensorCO = PT08.S1.CO.)

```

```{r}
time <- data$Time
temp <- data$Temperature

ggplot(aq_data, aes(x = GroundCO)) +
  geom_histogram(fill = "skyblue")

# boxplot for all numerical variable, check outliers
# replace all missing value with median
```

```{r}
aq_1 <- aq_data %>%
  mutate(across(where(is.numeric),
                ~ ifelse(is.na(.), median(., na.rm = TRUE), .)))
```

```{r}
num <- aq_1 %>%
  select(where(is.numeric)) %>%
  pivot_longer(everything(), names_to = "var", values_to = "val")
ggplot(num, aes(x = var, y = val)) +
  geom_boxplot() +
  coord_flip() +
  theme_classic()

outlier_summary <- num %>%
  group_by(var) %>%
  mutate(q1  = quantile(val, .25, na.rm = TRUE),
         q3  = quantile(val, .75, na.rm = TRUE),
         iqr = q3 - q1,
         lo  = q1 - 1.5*iqr,
         hi  = q3 + 1.5*iqr,
         is_outlier = val < lo | val > hi) %>%
  summarise(n = n(),
            n_outliers = sum(is_outlier, na.rm = TRUE),
            prop_outliers = n_outliers / n)

outlier_summary

aq_no_outliers <- aq_1 %>%
  filter(if_all(where(is.numeric), ~ {
    qs  <- quantile(., c(.25, .75), na.rm = TRUE)
    iqr <- diff(qs)
    lo  <- qs[1] - 1.5*iqr
    hi  <- qs[2] + 1.5*iqr
    is.na(.) | (. >= lo & . <= hi)
  }))

cat("removed rows:", nrow(aq_1) - nrow(aq_no_outliers), "\n")
```
